<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.subscribe.mapper.RegisterMapper">
    <select id="ListRegister" resultType="com.example.subscribe.pojo.Vo.RegisterVo">
        SELECT
            p.name AS patientName,
            d.name AS doctorName,
            am.appointment_date AS appointmentDate,
            am.status AS status,
            am.created_at AS createdAt,
            am.updated_at AS updatedAt
        FROM
            appointments am
                LEFT JOIN patients p ON am.patient_id = p.patient_id
                LEFT JOIN doctors d  ON am.doctor_id =d.doctor_id
        WHERE
            am.is_valid = 1 AND p.is_valid=1 AND d.is_valid=1
        <if test="patientName != null and patientName != ''">
            AND p.name LIKE CONCAT('%', #{patientName}, '%')
        </if>
        <if test="doctorName != null and doctorName != ''">
            AND d.name LIKE CONCAT('%', #{doctorName}, '%')
        </if>
    </select>

    <insert id="addRegister" parameterType="com.example.subscribe.pojo.Qo.RegisterQo">
        INSERT INTO appointments (`patient_id`, `doctor_id`, `appointment_date`, `status`)
        VALUES (#{patientId}, #{doctorId}, #{appointmentDate}, #{status});
    </insert>

</mapper>
